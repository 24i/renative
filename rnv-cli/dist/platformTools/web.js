var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.buildWeb=buildWeb;exports.runWebDevServer=exports.configureWebProject=exports.runWeb=void 0;var _path=_interopRequireDefault(require("path"));var _shelljs=_interopRequireDefault(require("shelljs"));var _chalk=_interopRequireDefault(require("chalk"));var _open=_interopRequireDefault(require("open"));var _exec=require("../exec");var _common=require("../common");var _fileutils=require("../fileutils");var _require=require('child_process'),fork=_require.fork;function buildWeb(c,platform){(0,_common.logTask)("buildWeb:"+platform);var wbp=_path.default.resolve(c.nodeModulesFolder,'webpack/bin/webpack.js');return(0,_exec.execShellAsync)("NODE_ENV=production "+wbp+" -p --config ./platformBuilds/"+c.appId+"_"+platform+"/webpack.config.js");}var configureWebProject=function configureWebProject(c,platform){return new Promise(function(resolve,reject){(0,_common.logTask)("configureWebOSProject:"+platform);if(!(0,_common.isPlatformActive)(c,platform,resolve))return;(0,_common.copyBuildsFolder)(c,platform).then(function(){return configureProject(c,platform);}).then(function(){return resolve();}).catch(function(e){return reject(e);});});};exports.configureWebProject=configureWebProject;var configureProject=function configureProject(c,platform,appFolderName){return new Promise(function(resolve,reject){(0,_common.logTask)("configureProject:"+platform);resolve();});};var runWeb=function runWeb(c,platform,port){return new Promise(function(resolve,reject){(0,_common.logTask)("runWeb:"+platform+":"+port);(0,_common.checkPortInUse)(c,platform,port).then(function(isPortActive){if(!isPortActive){(0,_common.logInfo)("Looks like your "+_chalk.default.white(platform)+" devServer at port "+_chalk.default.white(port)+" is not running. Starting it up for you...");_runWebBrowser(c,platform,port,500).then(function(){return runWebDevServer(c,platform,port);}).then(function(){return resolve();}).catch(function(e){return reject(e);});}else{(0,_common.logInfo)("Looks like your "+_chalk.default.white(platform)+" devServer at port "+_chalk.default.white(port)+" is already running. ReNativeWill use it!");_runWebBrowser(c,platform,port).then(function(){return resolve();}).catch(function(e){return reject(e);});}}).catch(function(e){return reject(e);});});};exports.runWeb=runWeb;var _runWebBrowser=function _runWebBrowser(c,platform,port){var delay=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return new Promise(function(resolve,reject){(0,_open.default)("http://0.0.0.0:"+port);resolve();});};var runWebDevServer=function runWebDevServer(c,platform,port){return new Promise(function(resolve,reject){(0,_common.logTask)("runWebDevServer:"+platform);var appFolder=(0,_common.getAppFolder)(c,platform);var templateFolder=(0,_common.getAppTemplateFolder)(c,platform);var wpConfig=_path.default.join(appFolder,'webpack.config.js');var wpPublic=_path.default.join(appFolder,'public');(0,_fileutils.copyFileSync)(_path.default.join(templateFolder,'_privateConfig','webpack.config.dev.js'),_path.default.join(appFolder,'webpack.config.js'));var wds=_path.default.resolve(c.nodeModulesFolder,'webpack-dev-server/bin/webpack-dev-server.js');_shelljs.default.exec("node "+wds+" -d --devtool source-map --config "+wpConfig+"  --inline --hot --colors --content-base "+wpPublic+" --history-api-fallback --host 0.0.0.0 --port "+port);resolve();});};exports.runWebDevServer=runWebDevServer;