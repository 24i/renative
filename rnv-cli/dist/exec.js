var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.execShellAsync=execShellAsync;exports.default=exports.execCLI=exports.executeAsync=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _path=_interopRequireDefault(require("path"));var _shelljs=_interopRequireDefault(require("shelljs"));var _fs=_interopRequireDefault(require("fs"));var _chalk=_interopRequireDefault(require("chalk"));var _common=require("./common");var _require=require('child_process'),spawn=_require.spawn;var SEPARATOR=process.platform==='win32'?';':':';var env=(0,_extends2.default)({},process.env);env.PATH=_path.default.resolve('./node_modules/.bin')+SEPARATOR+env.PATH;var execCLI=function execCLI(c,cli,command){var log=arguments.length>3&&arguments[3]!==undefined?arguments[3]:console.log;return new Promise(function(resolve,reject){log("execCLI:"+cli+":"+command);var p=c.cli[cli];if(!_fs.default.existsSync(p)){reject("Location of your cli "+_chalk.default.white(p)+" does not exists. check your "+_chalk.default.white('~/.rnv/config.json')+" file if you SDK path is correct");return;}_shelljs.default.exec(p+" "+command,function(error,stdout,stderr){if(error){reject("Command "+cli+" failed: \""+_chalk.default.white(p+" "+command)+"\". "+error);return;}resolve(stdout.trim());});});};exports.execCLI=execCLI;var executeAsync=function executeAsync(cmd,args){var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{cwd:process.cwd(),stdio:'inherit',env:env};return new Promise(function(resolve,reject){if(cmd==='npm'&&process.platform==='win32')cmd='npm.cmd';var command=spawn(cmd,args,opts);var stdout='';var ended=false;command.stdout&&command.stdout.on('data',function(output){var outputStr=output.toString();console.log('data',output);if(outputStr)stdout+=outputStr;});command.on('close',function(code){(0,_common.logDebug)("Command "+cmd+(args?" "+args.join(' '):'')+" exited with code "+code);if(code!==0){reject(new Error("process exited with code "+code));}else{ended=true;(0,_common.logDebug)('Execute Command:',command);resolve(stdout);}});command.on('error',function(error){(0,_common.logDebug)("Command "+cmd+(args?" "+args.join(' '):'')+" errored with "+error);reject(new Error("process errored with "+error));});var killChildProcess=function killChildProcess(){if(ended)return;console.log("Killing child process "+cmd+(args?" "+args.join(' '):''));command.kill(1);};process.on('exit',killChildProcess);process.on('SIGINT',killChildProcess);});};exports.executeAsync=executeAsync;function execShellAsync(command){return new Promise(function(resolve){_shelljs.default.exec(command,resolve);});}var _default={executeAsync:executeAsync,execShellAsync:execShellAsync,execCLI:execCLI};exports.default=_default;