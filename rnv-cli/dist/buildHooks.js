var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.listPipes=exports.executePipe=exports.executeHook=exports.listHooks=exports.buildHooks=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _chalk=_interopRequireDefault(require("chalk"));var _path=_interopRequireDefault(require("path"));var _fs=_interopRequireDefault(require("fs"));var _child_process=_interopRequireDefault(require("child_process"));var _common=require("./common");var _constants=require("./constants");var _exec=require("./exec");var _fileutils=require("./fileutils");var _tizen=require("./platformTools/tizen");var _webos=require("./platformTools/webos");var _android=require("./platformTools/android");var _apple=require("./platformTools/apple");var _firefox=require("./platformTools/firefox");var _runner=require("./cli/runner");var _platform=require("./cli/platform");var _plugin=require("./cli/plugin");var _target=require("./cli/target");var _app=require("./cli/app");var PIPES=(0,_objectSpread2.default)({},_runner.PIPES,_platform.PIPES,_plugin.PIPES,_target.PIPES,_app.PIPES);var executeHook=function executeHook(c){return new Promise(function(resolve,reject){(0,_common.logTask)('executeHook');buildHooks(c).then(function(){if(c.buildHooks[c.program.exeMethod]){c.buildHooks[c.program.exeMethod](c).then(function(){return resolve();}).catch(function(e){return reject(e);});}else{reject("Method name "+_chalk.default.white(c.program.exeMethod)+" does not exists in your buildHooks!");}}).catch(function(e){return reject(e);});});};exports.executeHook=executeHook;var executePipe=function executePipe(c,key){return new Promise(function(resolve,reject){(0,_common.logTask)("executePipe:"+key);buildHooks(c).then(function(){var pipe=c.buildPipes?c.buildPipes[key]:null;if(Array.isArray(pipe)){var chain=pipe.reduce(function(accumulatorPromise,next){return accumulatorPromise.then(function(){return next(c);});},Promise.resolve()).then(function(){return resolve();}).catch(function(e){return reject(e);});return;}if(pipe){c.buildPipes[key](c).then(function(){return resolve();}).catch(function(e){return reject(e);});return;}resolve();}).catch(function(e){return reject(e);});});};exports.executePipe=executePipe;var buildHooks=function buildHooks(c){return new Promise(function(resolve,reject){(0,_common.logTask)('buildHooks');if(_fs.default.existsSync(c.buildHooksIndexPath)){if(c.isBuildHooksReady){resolve();return;}var babel=_path.default.resolve(c.nodeModulesFolder,'@babel/cli/bin/babel.js');(0,_exec.executeAsync)(babel,['--no-babelrc',c.buildHooksFolder,'-d',c.buildHooksDistFolder,'--presets=@babel/env']).then(function(){var h=require(c.buildHooksDistIndexPath);c.buildHooks=h.hooks;c.buildPipes=h.pipes;c.isBuildHooksReady=true;resolve();}).catch(function(e){console.log(e);resolve();});}else{(0,_common.logWarning)("Your buildHook "+_chalk.default.white(c.buildHooksIndexPath)+" is missing!. Skipping operation");resolve();}});};exports.buildHooks=buildHooks;var listHooks=function listHooks(c){return new Promise(function(resolve,reject){(0,_common.logTask)('listHooks');buildHooks(c).then(function(){var hooksAsString="\n"+_chalk.default.blue('Hooks:')+"\n";if(c.buildHooks){var i=1;for(var k in c.buildHooks){hooksAsString+="-["+i+"] "+_chalk.default.white(k)+"\n";i++;}if(c.buildPipes){hooksAsString+="\n"+_chalk.default.blue('Pipes:')+"\n";i=1;for(var _k in c.buildPipes){hooksAsString+="-["+i+"] "+_chalk.default.white(_k)+"\n";i++;}}console.log(hooksAsString);resolve();}else{reject('Your buildHooks object is empty!');}}).catch(function(e){return reject(e);});});};exports.listHooks=listHooks;var listPipes=function listPipes(c){return new Promise(function(resolve,reject){(0,_common.logTask)('listPipes');var pipesAsString='\n';var i=1;for(var k in PIPES){pipesAsString+="-["+i+"] "+_chalk.default.white(PIPES[k])+"\n";i++;}console.log(pipesAsString);});};exports.listPipes=listPipes;